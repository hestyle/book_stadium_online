<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>体育场馆</title>
    <script src="../../js/jquery.min.js"></script>
    <script src="../../layui/layui.all.js"></script>
    <script src="../../js/common.js"></script>
    <script src="../../js/jquery.cookie.js"></script>
    <script src="../../plugins/soulTable/soulTable.js"></script>
    <link rel="stylesheet" href="../../layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../plugins/soulTable/soulTable.css">
</head>
    <style>
        .layui-laypage .layui-laypage-curr .layui-laypage-em {
            background-color: #0090FF;
        }
    </style>
    <body>
        <div class="div-search">
            <div class="layui-inline">
                <input class="layui-input" id="stadiumNameKey" autocomplete="off" placeholder="请输入场馆名" style="width: 300px;">
            </div>
            <button class="layui-btn layui-btn-normal" data-type="reload" id="searchStadiumButton">搜索</button>
        </div>
        <table id="stadiumTable" lay-filter="test"></table>
    </body>
    <!--每条数据的操作栏-->
    <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="lookStadium">查看</a>
        <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="lookStadiumComment">查看场馆评价</a>
        <a class="layui-btn layui-btn-xs" lay-event="lookStadiumBook">查看场馆预约</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="deleteStadium">删除</a>
    </script>
    <!--每条数据的查看操作-->
    <script type="text/html" id="lookStadiumDialog">
        <form class="layui-form" action="" style="padding: 20px;width: 600px;" lay-filter="lookStadiumDialogForm">
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">id</label>
                <div class="layui-input-inline">
                    <input id="lookStadium_id" type="text" name="id" placeholder="场馆id" autocomplete="off" class="layui-input" style="width: 140%;" disabled>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">名称</label>
                <div class="layui-input-inline">
                    <input id="lookStadium_name" type="text" name="name" placeholder="场馆名称" autocomplete="off" class="layui-input" style="width: 140%;" disabled>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">地址</label>
                <div class="layui-input-inline">
                    <input id="lookStadium_address" type="text" name="address" placeholder="请输入地址" autocomplete="off" class="layui-input" style="width: 140%;" disabled>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">描述</label>
                <div class="layui-input-inline">
                    <textarea id="lookStadium_description" name="description" placeholder="请输入描述" class="layui-textarea" style="width: 140%;" disabled></textarea>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">图片</label>
                <div class="layui-input-inline" id="lookStadium_images" style="width: 450px;">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">场馆分类</label>
                <div class="layui-input-inline">
                    <input id="lookStadium_stadiumCategoryId" type="text" name="stadiumCategoryId" autocomplete="off" class="layui-input" style="width: 140%;" disabled>
                </div>
            </div>
        </form>
    </script>
    <!--单条数据的插入操作-->
    <script type="text/html" id="addDialog">
        <form id="add_form" class="layui-form" action="" style="padding: 20px;" lay-filter="addDialogForm">
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 20%;">名称</label>
                <div class="layui-input-inline">
                    <input id="add_name" type="text" name="name" placeholder="请输入名称" autocomplete="off" class="layui-input" style="width: 140%;">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 20%;">地址</label>
                <div class="layui-input-inline">
                    <input id="add_address" type="text" name="address" placeholder="请输入地址" autocomplete="off" class="layui-input" style="width: 140%;">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 20%;">描述</label>
                <div class="layui-input-inline">
                    <textarea id="add_description" name="description" placeholder="请输入描述" class="layui-textarea" style="width: 140%;"></textarea>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 20%;">图片</label>
                <div class="layui-input-inline" style="width: 400px;">
                    <input id="add_image_paths" type="text" name="imagePaths" placeholder="图片路径" autocomplete="off" class="layui-input" style="width: 140%; display:none;" disabled>
                    <button type="button" class="layui-btn" id="add_uploadImagesButton"><i class="layui-icon">&#xe67c;</i>添加图片</button>
                    <label style="color: red;">最多只允许上传5张！</label>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 20%;">预览</label>
                <div class="layui-input-inline" id="stadiumImages" style="width: 450px;">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 20%;">场馆分类</label>
                <div class="layui-input-inline">
                    <input id="add_stadiumCategoryId_name" type="text" name="stadiumCategoryId_name" placeholder="请选择场馆分类！" autocomplete="off" class="layui-input" style="width: 140%;" disabled>
                    <input id="add_stadiumCategoryId" type="text" name="stadiumCategoryId" placeholder="请选择场馆分类！" autocomplete="off" class="layui-input" style="width: 140%;display: none;" disabled>
                    <button id="select_stadiumCategory" type="button" class="layui-btn" onclick="selectStadiumCategory(1)">选择场馆分类</button>
                </div>
            </div>
            <table id="add_stadiumCategoryIds_table" lay-filter="addStadiumCategoryIdsTable"></table>
        </form>
    </script>
    <!--单条数据修改图片资源-->
    <script type="text/html" id="changeImageDialog">
        <form id="change_Image_form" class="layui-form" action="#" style="padding: 20px;" lay-filter="changeImageDialogForm">
            <div class="layui-form-item">
                <label class="layui-form-label">id</label>
                <div class="layui-input-inline">
                    <input id="change_image_id" type="text" name="id" placeholder="请输入id" autocomplete="off" class="layui-input" style="width: 140%;" disabled>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">名称</label>
                <div class="layui-input-inline">
                    <input id="change_image_name" type="text" name="name" placeholder="请输入名称" autocomplete="off" class="layui-input" style="width: 140%;" disabled>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">图片</label>
                <div class="layui-input-inline" style="width: 400px;">
                    <input id="change_image_paths" type="text" name="imagePaths" placeholder="图片路径" autocomplete="off" class="layui-input" style="width: 140%; display:none;" disabled>
                    <button type="button" class="layui-btn" id="change_uploadImagesButton"><i class="layui-icon">&#xe67c;</i>添加图片</button>
                    <label style="color: red;">最多只允许上传5张！</label>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">预览</label>
                <div class="layui-input-inline" id="change_stadiumImages" style="width: 450px;">
                </div>
            </div>
        </form>
    </script>
    <!--单条数据修改分类-->
    <script type="text/html" id="changeCategoryIdsDialog">
        <form id="change_categoryIds_form" class="layui-form" action="" style="padding: 20px;" lay-filter="changeCategoryIdsDialogForm">
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 20%;">id</label>
                <div class="layui-input-inline">
                    <input id="change_categoryIds_id" type="text" name="id" placeholder="请输入id" autocomplete="off" class="layui-input" style="width: 140%;" disabled>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 20%;">名称</label>
                <div class="layui-input-inline">
                    <input id="change_categoryIds_name" type="text" name="name" placeholder="请输入名称" autocomplete="off" class="layui-input" style="width: 140%;" disabled>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 20%;">场馆分类</label>
                <div class="layui-input-inline">
                    <input id="change_stadiumCategoryId_name" type="text" name="stadiumCategoryId_name" placeholder="请选择场馆分类！" autocomplete="off" class="layui-input" style="width: 140%;" disabled>
                    <input id="change_stadiumCategoryId" type="text" name="stadiumCategoryId" placeholder="请选择场馆分类！" autocomplete="off" class="layui-input" style="width: 140%;display: none;" disabled>
                    <button id="change_stadiumCategory" type="button" class="layui-btn" onclick="selectStadiumCategory(2)">选择场馆分类</button>
                </div>
            </div>
        </form>
    </script>
    <!--场馆分类page列表-->
    <script type="text/html" id="stadiumCategoryPageDialog">
        <table id="all_stadiumCategory_table" lay-filter="allStadiumTable"></table>
    </script>
    <!--场馆评论列表-->
    <script type="text/html" id="stadiumCommentPageDialog">
        <table id="stadiumComment_table" lay-filter="stadiumCommentTable"></table>
    </script>
    <!--场馆评论单条数据的操作栏-->
    <script type="text/html" id="stadiumCommentTableBarTemplet">
        <a class="layui-btn layui-btn-xs" lay-event="lookStadiumCommentDetail">查看</a>
        <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="delete">删除</a>
    </script>
    <script type="text/html" id="stadiumCommentUsernameTemplet">
        {{d.commentUser.username}}
    </script>
    <script type="text/html" id="stadiumCommentStarCountTemplet">
        {{#  if(d.starCount >= 1){ }}
        <img src="/book_stadium_online/image/star.svg" style="width: 20px;height: 20px;"/>
        {{#  } else { }}
        <img src="/book_stadium_online/image/starEmpty.svg" style="width: 20px;height: 20px;"/>
        {{#  }}}
        {{#  if(d.starCount >= 2){ }}
        <img src="/book_stadium_online/image/star.svg" style="width: 20px;height: 20px;"/>
        {{#  } else { }}
        <img src="/book_stadium_online/image/starEmpty.svg" style="width: 20px;height: 20px;"/>
        {{#  }}}
        {{#  if(d.starCount >= 3){ }}
        <img src="/book_stadium_online/image/star.svg" style="width: 20px;height: 20px;"/>
        {{#  } else { }}
        <img src="/book_stadium_online/image/starEmpty.svg" style="width: 20px;height: 20px;"/>
        {{#  }}}
        {{#  if(d.starCount >= 4){ }}
        <img src="/book_stadium_online/image/star.svg" style="width: 20px;height: 20px;"/>
        {{#  } else { }}
        <img src="/book_stadium_online/image/starEmpty.svg" style="width: 20px;height: 20px;"/>
        {{#  }}}
        {{#  if(d.starCount >= 5){ }}
        <img src="/book_stadium_online/image/star.svg" style="width: 20px;height: 20px;"/>
        {{#  } else { }}
        <img src="/book_stadium_online/image/starEmpty.svg" style="width: 20px;height: 20px;"/>
        {{#  }}}
    </script>
    <!--StadiumComment查看操作-->
    <script type="text/html" id="lookStadiumCommentDetailDialog">
        <form class="layui-form" action="" style="padding: 20px;" lay-filter="stadiumCommentForm">
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">用户名</label>
                <div class="layui-input-inline">
                    <input id="lookStadiumCommentUsername" type="text" placeholder="发表评价的用户名" autocomplete="off" class="layui-input" style="width: 140%;" disabled>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">评价内容</label>
                <div class="layui-input-inline">
                    <textarea id="lookStadiumCommentContent" placeholder="评价的内容" class="layui-textarea" style="width: 140%;" disabled></textarea>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">评价星级</label>
                <div id="lookStadiumCommentStarCount" class="layui-input-inline" style="width: 65%;"></div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">评价时间</label>
                <div class="layui-input-inline">
                    <input id="lookStadiumCommentCommentedTime" placeholder="评价时间" class="layui-input" style="width: 140%;" disabled />
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">我的回复</label>
                <div class="layui-input-inline">
                    <textarea id="lookStadiumCommentManagerReply" name="description" placeholder="无" class="layui-textarea" style="width: 140%;" disabled></textarea>
                </div>
            </div>
        </form>
    </script>
    <!--场馆预约列表-->
    <script type="text/html" id="stadiumBookPageDialog">
        <table id="stadiumBook_table" lay-filter="stadiumBookTable"></table>
    </script>
    <!--体育场馆预约表 col模板-->
    <script type="text/html" id="bookStateTemplate">
        {{#  if(d.bookState === 0){ }}
        <span style="color: #000000;">暂未开始</span>
        {{#  } else if(d.bookState === 1){ }}
        <span style="color: #FF0000;">正在进行</span>
        {{#  } else { }}
        <span style="color: #0000FF;">已结束</span>
        {{#  } }}
    </script>
    <!--场馆预约单条数据的操作栏-->
    <script type="text/html" id="stadiumBookTableBarTemplet">
        <a class="layui-btn layui-btn-xs" lay-event="lookStadiumBookDetail">查看</a>
        <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="delete">删除</a>
    </script>
    <!--StadiumComment回复操作-->
    <script type="text/html" id="replyStadiumCommentDialog">
        <form class="layui-form" action="" style="padding: 20px;width: 380px;" lay-filter="stadiumCommentReplyForm">
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">评价内容</label>
                <div class="layui-input-inline">
                    <textarea id="replyStadiumCommentContent" placeholder="评价的内容" class="layui-textarea" style="width: 140%;" disabled></textarea>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">评价星级</label>
                <div id="replyStadiumCommentStarCount" class="layui-input-inline" style="width: 65%;"></div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 15%;">回复内容</label>
                <div class="layui-input-inline">
                    <textarea id="replyStadiumCommentManagerReply" placeholder="请输入回复的内容~" class="layui-textarea" style="width: 140%;"></textarea>
                </div>
            </div>
        </form>
    </script>
    <script>
        layui.config({
            base: '../../plugins/soulTable/',
            version: 'v1.5.20'
        }).extend({
            soulTable: 'soulTable/soulTable.slim'
        });
        layuiModules=['table', 'layer', 'form', 'upload', 'soulTable'];
        // 上传图片
        var haveUploadCount = 0;
        function mounted() {
            table.render({
                elem: '#stadiumTable'
                , defaultToolbar: ['print', 'exports']
                , method: 'POST'
                , cols: [[
                    {title: '<a class="" style="font-size: 20px; color:black;">体育场馆表</a>',align: 'center', colspan: 8} //rowspan即纵向跨越的单元格数
                ],[ //表头
                    {field: 'id', title: 'id', width: 70, sort: true}
                    , {field: 'name', title: '名称', width: 200, sort: true}
                    , {field: 'address', title: '地址', width: 200, sort: true}
                    , {field: 'description', title: '描述', width: 200, sort: true}
                    , {field: 'stadiumCategoryId', title: '分类', width: 150, sort: true}
                    , {field: 'imagePaths', title: '图片', width: 150, sort: true}
                    , {fixed: 'right', width: 320, align: 'center', toolbar: '#barDemo'} //这里的toolbar值是模板元素的选择器
                ]]
                , page: true
                , url: "/book_stadium_online/stadium/findByNameKeyAndPage.do"
                , headers: {
                    token: $.cookie("systemManagerToken")
                }
                , request: {
                    pageName: 'pageIndex' //页码的参数名称，默认：page
                    ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
                }
                , response: {
                    statusName: 'code' //规定数据状态的字段名称，默认：code
                    ,statusCode: 200 //规定成功的状态码，默认：0
                    ,msgName: 'message' //规定状态信息的字段名称，默认：msg
                    ,countName: 'count' //规定数据总数的字段名称，默认：count
                    ,dataName: 'data' //规定数据列表的字段名称，默认：data
                }
                , parseData: function(res){ //res 即为原始返回的数据
                    return {
                        "code": res.code, //解析接口状态
                        "message": res.message, //解析提示文本
                        "count": res.count, //解析数据长度
                        "data": res.data //解析数据列表
                    };
                }
            });
            //监听工具条
            table.on('tool(test)', function (obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
                var data = obj.data; //获得当前行数据
                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                var tr = obj.tr; //获得当前行 tr 的DOM对象

                if (layEvent === 'lookStadium') {
                    layer.open({
                        type: 1,
                        title: '体育场馆【' + data.name + '】',
                        area:['660px','70%'],
                        content: $('#lookStadiumDialog').html(),
                        btn: ['关闭'],
                        success: function (index, layero) {
                            form.render();
                            if (data.imagePaths != null && data.imagePaths.length !== 0) {
                                var imagePaths = data.imagePaths.split(',');
                                for (var i in imagePaths) {
                                    $('#lookStadium_images').append('<img class="loginIcon" src="' + imagePaths[i] + '" style="width: 80px;height: 80px;margin-right: 10px">');
                                }
                            }
                            form.val("lookStadiumDialogForm", data);
                            if (data.stadiumCategoryId != null) {
                                $.ajax({
                                    "url" : '/book_stadium_online/stadiumCategory/findById.do',
                                    "data" : {"stadiumCategoryId":data.stadiumCategoryId},
                                    "type" : "POST",
                                    "dataType" : "json",
                                    "beforeSend": function (request) {
                                        request.setRequestHeader("token", $.cookie("systemManagerToken"))
                                    },
                                    "success" : function (json) {
                                        if (json.code === 200) {
                                            // 保存到全局变量
                                            var stadiumCategory = json.data;
                                            $('#lookStadium_stadiumCategoryId').val(stadiumCategory.title);
                                        } else {
                                            // 弹出中间提示框
                                            layer.open({
                                                title: "提示信息",
                                                content: json.message,
                                                yes: function (index2, layero) {
                                                    if (json.code === 402) {
                                                        // code==402说明未登录(BaseController.java定义)
                                                        parent.location.href = "../../login.html";
                                                    }
                                                    layer.close(index2);
                                                }
                                            });
                                        }
                                    },
                                    "error" : function () {
                                        // 弹出中间提示框
                                        layer.open({
                                            title: "提示信息",
                                            content: "出现异常！"
                                        });
                                    }
                                });
                            }
                        },
                        yes: function (index, layero) {
                            layer.close(index);
                        }
                    });
                } else if (layEvent === 'lookStadiumComment') {
                    layer.open({
                        type: 1,
                        title: '场馆【' + data.name + '】评价',
                        area:['70%','80%'],
                        content: $('#stadiumCommentPageDialog').html(),
                        btn: ['关闭'],
                        success: function (index, layero) {
                            // 填充行数据
                            form.render();
                            table.render({
                                elem: '#stadiumComment_table'
                                , width: 980
                                , defaultToolbar: ['print', 'exports']
                                , method: 'POST'
                                , cols: [[
                                    {title: '<a class="" style="font-size: 20px; color:black;">场馆【'+ data.name + '】评论表</a>',align: 'center', colspan: 8} //rowspan即纵向跨越的单元格数
                                ],[ //表头
                                    {field: 'username', title: '用户名', width: 140, sort: true, templet: '#stadiumCommentUsernameTemplet'}
                                    , {field: 'content', title: '评价内容', width: 200, sort: true}
                                    , {field: 'starCount', title: '评价星级', width: 160, sort: true, templet: '#stadiumCommentStarCountTemplet'}
                                    , {field: 'commentedTime', title: '评价时间', width: 180, sort: true}
                                    , {field: 'managerReply', title: '我的回复', width: 150, sort: true}
                                    , {field: 'toolBar_field', width: 120, align: 'center', templet: '#stadiumCommentTableBarTemplet'} //这里的toolbar值是模板元素的选择器
                                ]]
                                , page: true
                                , url: "/book_stadium_online/stadiumComment/findByStadiumIdAndPage.do"
                                , where: {
                                    stadiumId: data.id
                                }
                                , headers: {
                                    token: $.cookie("systemManagerToken")
                                }
                                , request: {
                                    pageName: 'pageIndex' //页码的参数名称，默认：page
                                    ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
                                }
                                , response: {
                                    statusName: 'code' //规定数据状态的字段名称，默认：code
                                    ,statusCode: 200 //规定成功的状态码，默认：0
                                    ,msgName: 'message' //规定状态信息的字段名称，默认：msg
                                    ,countName: 'count' //规定数据总数的字段名称，默认：count
                                    ,dataName: 'data' //规定数据列表的字段名称，默认：data
                                }
                                , parseData: function(res){ //res 即为原始返回的数据
                                    res.data = res.data.map(function(d){d['toolBar_field']='';return d;});
                                    return {
                                        "code": res.code, //解析接口状态
                                        "message": res.message, //解析提示文本
                                        "count": res.count, //解析数据长度
                                        "data": res.data //解析数据列表
                                    };
                                }
                            });
                        },
                        yes: function (index, layero) {
                            layer.close(index);
                        }
                    });
                } else if (layEvent === 'lookStadiumBook') {
                    layer.open({
                        type: 1,
                        title: '场馆【' + data.name + '】预约',
                        area:['80%','80%'],
                        content: $('#stadiumBookPageDialog').html(),
                        btn: ['关闭'],
                        success: function (index, layero) {
                            // 填充行数据
                            form.render();
                            table.render({
                                elem: '#stadiumBook_table'
                                , width: 980
                                , defaultToolbar: ['print', 'exports']
                                , method: 'POST'
                                , cols: [[
                                    {title: '<a class="" style="font-size: 20px; color:black;">场馆【'+ data.name + '】预约表</a>',align: 'center', colspan: 8} //rowspan即纵向跨越的单元格数
                                ],[ //表头
                                    {field: 'id', title: 'id', width: 70, sort: true}
                                    , {field: 'bookState', title: '预约状态', width: 105, sort: true, templet: '#bookStateTemplate'}
                                    , {field: 'maxBookCount', title: '预约容量', width: 115, sort: true}
                                    , {field: 'nowBookCount', title: '已预约数', width: 115, sort: true}
                                    , {field: 'startTime', title: '起始时间', width: 165, sort: true}
                                    , {field: 'endTime', title: '终止时间', width: 165, sort: true}
                                    , {fixed: 'right', align: 'left', toolbar: '#stadiumBookTableBarTemplet'} //这里的toolbar值是模板元素的选择器
                                ]]
                                , page: true
                                , url: "/book_stadium_online/stadiumBook/systemManagerFindByStadiumIdAndPage.do"
                                , where: {
                                    stadiumId: data.id
                                }
                                , headers: {
                                    token: $.cookie("systemManagerToken")
                                }
                                , request: {
                                    pageName: 'pageIndex' //页码的参数名称，默认：page
                                    ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
                                }
                                , response: {
                                    statusName: 'code' //规定数据状态的字段名称，默认：code
                                    ,statusCode: 200 //规定成功的状态码，默认：0
                                    ,msgName: 'message' //规定状态信息的字段名称，默认：msg
                                    ,countName: 'count' //规定数据总数的字段名称，默认：count
                                    ,dataName: 'data' //规定数据列表的字段名称，默认：data
                                }
                                , parseData: function(res){ //res 即为原始返回的数据
                                    return {
                                        "code": res.code, //解析接口状态
                                        "message": res.message, //解析提示文本
                                        "count": res.count, //解析数据长度
                                        "data": res.data //解析数据列表
                                    };
                                }
                            });
                        },
                        yes: function (index, layero) {
                            layer.close(index);
                        }
                    });
                }
            });
            //监听工具条
            table.on('tool(stadiumCommentTable)', function (obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
                var data = obj.data; //获得当前行数据
                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                var tr = obj.tr; //获得当前行 tr 的DOM对象

                if (layEvent === 'lookStadiumCommentDetail') {
                    layer.open({
                        type: 1,
                        title: '场馆评论详情',
                        area: ['60%', '70%'],
                        content: $('#lookStadiumCommentDetailDialog').html(),
                        btn: ['关闭'],
                        success: function (index, layero) {
                            // 填充行数据
                            form.render();
                            form.val("lookStadiumCommentDetailDialog", data);
                            $('#lookStadiumCommentUsername').val(data.commentUser.username);
                            $('#lookStadiumCommentContent').val(data.content);
                            for (var i = 0; i < parseInt(data.starCount); ++i) {
                                $('#lookStadiumCommentStarCount').append('<img src="/book_stadium_online/image/star.svg" style="width: 20px;height: 20px;"/>');
                            }
                            for (var i = parseInt(data.starCount); i < 5; ++i) {
                                $('#lookStadiumCommentStarCount').append('<img src="/book_stadium_online/image/starEmpty.svg" style="width: 20px;height: 20px;"/>');
                            }
                            $('#lookStadiumCommentCommentedTime').val(data.commentedTime);
                            $('#lookStadiumCommentManagerReply').val(data.managerReply);
                        },
                        yes: function (index, layero) {
                            layer.close(index);
                        }
                    });
                } else if (layEvent === 'replyStadiumComment') {
                    layer.open({
                        type: 1,
                        title: '场馆评论回复',
                        area: ['450px'],
                        content: $('#replyStadiumCommentDialog').html(),
                        btn: ['回复', '取消'],
                        success: function (index, layero) {
                            // 填充行数据
                            form.render();
                            $('#replyStadiumCommentContent').val(data.content);
                            for (var i = 0; i < parseInt(data.starCount); ++i) {
                                $('#replyStadiumCommentStarCount').append('<img src="/book_stadium_online/image/star.svg" style="width: 20px;height: 20px;"/>');
                            }
                            for (var i = parseInt(data.starCount); i < 5; ++i) {
                                $('#replyStadiumCommentStarCount').append('<img src="/book_stadium_online/image/starEmpty.svg" style="width: 20px;height: 20px;"/>');
                            }
                        },
                        yes: function (index, layero) {
                            // 更新缓存，同步到服务器
                            var url ="/book_stadium_online/stadiumComment/managerReply.do";
                            var postData = '{"id":'+ data.id + ',"managerReply":"' + $('#replyStadiumCommentManagerReply').val() + '"}';
                            $.ajax({
                                "url" : url,
                                "data" : {"stadiumCommentData":postData},
                                "type" : "POST",
                                "dataType" : "json",
                                "beforeSend": function (request) {
                                    request.setRequestHeader("token", $.cookie("systemManagerToken"))
                                },
                                "success" : function (json) {
                                    layer.open({
                                        title: "提示信息",
                                        content: json.message
                                    });
                                    if (json.code === 200) {
                                        // 更新成功，则关闭重置窗口
                                        obj.update({
                                            managerReply: $('#replyStadiumCommentManagerReply').val(),
                                            toolBar_field: ''
                                        });
                                        layer.close(index);
                                    }
                                },
                                "error" : function () {
                                    // 弹出中间提示框
                                    layer.open({
                                        title: "提示信息",
                                        content: "删除失败，出现未知异常！"
                                    });
                                }
                            });
                        },
                        btn2: function (index, layero) {
                            layer.close(index);
                        }
                    });
                }
            });
            $('#searchStadiumButton').on('click', function () {
                if ($('#stadiumNameKey').val().length === 0) {
                    layer.open({
                        title: '提示信息',
                        content: "请输入场馆名称关键字！"
                    });
                    return false;
                }
                var nameKey = $('#stadiumNameKey').val();
                layui.table.reload('stadiumTable', {
                    page: {
                        curr: 1
                    }
                    ,where: {
                        nameKey: nameKey
                    }
                });
            });
        }

        function checkAddForm() {
            if ($('#add_name').val().length === 0) {
                layer.open({
                    title: "提示信息",
                    content: "场馆名称不能为空！"
                });
                return false;
            }
            if (($('#add_address').val() + '').length === 0) {
                layer.open({
                    title: "提示信息",
                    content: "场馆地址必须填写！"
                });
                return false;
            }
            if ($('#add_description').val().length === 0) {
                layer.open({
                    title: "提示信息",
                    content: "场馆描述不能为空！"
                });
                return false;
            }
            if ($('#add_stadiumCategoryId').val().length === 0) {
                layer.open({
                    title: "提示信息",
                    content: "请设置场馆所属分类！"
                });
                return false;
            }
            return true;
        }

        /**
         * 添加category
         * @param dialogIndex     dialogIndex===1代表“添加体育场馆”，dialogIndex===2代表“修改体育场馆分类”
         */
        function selectStadiumCategory(dialogIndex) {
            layer.open({
                type: 1,
                title: '选择场馆分类',
                area:['760px','80%'],
                content: $('#stadiumCategoryPageDialog').html(),
                btn: ['确定', '取消'],
                success: function (index, layero) {
                    // 填充change_categoryIds_table表格
                    table.render({
                        elem: '#all_stadiumCategory_table'
                        , width: 730
                        , defaultToolbar: ['print', 'exports']
                        , method: 'POST'
                        , cols: [[
                            {title: '<a class="" style="font-size: 20px; color:black;">场馆分类表</a>',align: 'center', colspan: 4} //rowspan即纵向跨越的单元格数
                        ],[ //表头
                            {type:'radio'}
                            , {field: 'id', title: 'id', width: 70, sort: true}
                            , {field: 'title', title: '名称', width: 300, sort: true}
                            , {field: 'description', title: '描述', width: 300, sort: true}
                        ]]
                        , page: true
                        , limit: 100
                        , url: "/book_stadium_online/stadiumCategory/findByPage.do"
                        , headers: {
                            token: $.cookie("systemManagerToken")
                        }
                        , request: {
                            pageName: 'pageIndex' //页码的参数名称，默认：page
                            ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
                        }
                        , response: {
                            statusName: 'code' //规定数据状态的字段名称，默认：code
                            ,statusCode: 200 //规定成功的状态码，默认：0
                            ,msgName: 'message' //规定状态信息的字段名称，默认：msg
                            ,countName: 'count' //规定数据总数的字段名称，默认：count
                            ,dataName: 'data' //规定数据列表的字段名称，默认：data
                        }
                        , parseData: function(res){ //res 即为原始返回的数据
                            return {
                                "code": res.code, //解析接口状态
                                "message": res.message, //解析提示文本
                                "count": res.count, //解析数据长度
                                "data": res.data //解析数据列表
                            };
                        }
                    });
                },
                yes: function (index, layero) {
                    // 获取all_stadiumCategory_table选中的id，dialogIndex，分别更新
                    var checkStatus = layui.table.checkStatus('all_stadiumCategory_table');
                    if (checkStatus.data.length === 0) {
                        layer.open({
                            title: "提示信息",
                            content: "添加失败，未选择需要添加的场馆分类项！"
                        });
                        return false;
                    }
                    var stadiumCategory = checkStatus.data[0];
                    layer.close(index);
                    // 再分别更新add_stadiumCategoryIds_table、change_categoryIds_table表
                    if (dialogIndex === 1) {
                        $('#add_stadiumCategoryId_name').val(stadiumCategory.title);
                        $('#add_stadiumCategoryId').val(stadiumCategory.id);
                    } else if (dialogIndex === 2) {
                        $('#change_stadiumCategoryId_name').val(stadiumCategory.title);
                        $('#change_stadiumCategoryId').val(stadiumCategory.id);
                    }
                },
                btn2: function (index, layero) {
                    //return false 开启该代码可禁止点击该按钮关闭
                }
            });
        }

        /**
         * 删除上传的图片
         * @param index     index===0代表“添加体育场馆弹窗”，index===1代表“修改体育场馆图片弹窗”
         */
        function deleteImage(obj, index) {
            var nowI = $(obj).attr("title");
            var changeImageDivs = $('.changeImageDiv');
            for (var i = parseInt(nowI) + 1; i < changeImageDivs.length; ++i) {
                $(changeImageDivs.get(i)).find('button[name=deleteImageBtn]').attr("title", i - 1);
            }
            if (index === 0) {
                if (changeImageDivs.length > 1) {
                    var imagePaths = $('#add_image_paths').val().split(',');
                    imagePaths.splice(parseInt(nowI), 1);
                    if (imagePaths.length === 1) {
                        $('#add_image_paths').val(imagePaths[0]);
                    } else {
                        $('#add_image_paths').val(imagePaths.join(','));
                    }
                } else {
                    $('#add_image_paths').val('');
                }
                $('#add_uploadImagesButton').show();
            } else if (index === 1) {
                if (changeImageDivs.length > 1) {
                    var imagePaths = $('#change_image_paths').val().split(',');
                    imagePaths.splice(parseInt(nowI), 1);
                    if (imagePaths.length === 1) {
                        $('#change_image_paths').val(imagePaths[0]);
                    } else {
                        $('#change_image_paths').val(imagePaths.join(','));
                    }
                } else {
                    $('#change_image_paths').val('');
                }
                $('#change_uploadImagesButton').show();
            }
            // 删除了一张图片
            haveUploadCount -= 1;
            $('.changeImageDiv')[nowI].remove();
        }
    </script>
</html>